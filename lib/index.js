!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("art-template"),require("merge"),require("through2"),require("gulp-util"),require("chalk"),require("require-from-string")):"function"==typeof define&&define.amd?define(["art-template","merge","through2","gulp-util","chalk","require-from-string"],t):"object"==typeof exports?exports.gulpJsart=t(require("art-template"),require("merge"),require("through2"),require("gulp-util"),require("chalk"),require("require-from-string")):e.gulpJsart=t(e["art-template"],e.merge,e.through2,e["gulp-util"],e.chalk,e["require-from-string"])}(global,(function(e,t,r,n,o,a){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){r(1);var n=r(2),o=r(3),a=r(4),i=r(5),u=r(6),c=r(7),s=r(8),l=console.log,p=u.replaceExtension,f=u.PluginError,m={name:String,styles:[String,Array],template:Function,data:Object,created:Function,mounted:Function},d={develop:"src",output:{path:"dist",assetsPath:"assets",assetsPrefix:"./"},dealMode:"art",mode:"development"};function g(e,t){function r(e,t){return e===String?"string"!=typeof t:!(t instanceof e)}var n;if(Object.keys(e).some((function(o){return Object.keys(t).some((function(a){if(a===o){n=a;var i=e[o],u=t[a];return i instanceof Array?function(e,t){return e.reduce((function(e,n){return r(n,t)&&e}),!0)}(i,u):r(i,u)}}))})))return new f("gulp-page-js-deal","[".concat(n,"]-类型错误"))}e.exports=function(e){e=a.recursive(!0,d,e||{});var t=c.yellow(e.dealMode);l(c.blue("[tip] 正在处理 ".concat(t," 文件，请稍等...")));var r=/\<PRIVATE_IMG[\S\s]*?\/\>/g,h=n.join(__dirname,"..",e.develop),v=n.join(__dirname,"..",e.output.path),j=n.join(e.output.assetsPath,"css"),y=n.join(e.output.assetsPath,"js"),b=n.join(e.output.assetsPath,"img"),x=e.output.assetsPrefix;return i.obj((function(a,i,d){if(a.isNull())return d(null,a);if(a.isStream()){return this.emit("error",new f("gulp-page-js-deal","Streaming not supported!")),d()}var q=this,S=n.dirname(a.path),P=n.basename(a.path),_=a.contents.toString(),w=_.match(/require\(['|"]\S+['|"]\)/g);w.map((function(t,r){var o=t.match(/['|"](\S+)['|"]/)[1],a=n.join(S,o).replace(/\\/g,"\\\\"),i="development"===e.mode?"reload":"require",u="".concat(i,"('").concat(a,"')");_=_.replace(w[r],u)})),"development"===e.mode&&(_='const reload = require("require-reload")(require)\r\n'+_);var M=s(_),E=g(m,M);if(E)return this.emit("error",E),d();var O,T=M.name,F=M.styles,k=M.template,A=M.data,I="string"==typeof F?[F]:F,R=[{name:"created",rep:"<PRIVATE_CREATED/>"},{name:"mounted",rep:"<PRIVATE_MOUNTED/>"}];function V(e){Buffer.isBuffer(e)&&(e=e.toString());var t=e.length;return t=t>1024?(t/1024-.05).toFixed(2)+"kb":t.toFixed(2)+"byte"}function z(e,t){t=t||"link";var r=T+"-"+n.basename(e),o=n.join(j,r);if("path"===t)return o;var a=o;return".less"===n.extname(e)&&(a=p(o,".css")),a=a.replace(/\\/g,"/"),'<link rel="stylesheet" href="'.concat(x).concat(a,'" />')}function B(e,t){if(!M[e])return"";t=t||"script";var r=T+"-"+e+"-"+P,o=n.join(y,r);return o=p(o,".js"),"path"===t?o:(o=o.replace(/\\/g,"/"),'<script src="'.concat(x).concat(o,'"><\/script>'))}function D(e,t){t=t||"img";var r=/src=["|'](\S+\.(jpeg|png|jpg|gif){1})["|']/,o=e.match(r);if(!o)return"";if("src"===t)return o[1];var a=n.basename(o[1]),i=n.join(b,a);return"path"===t?i:(i=i.replace(/\\/g,"/"),e.replace(r,'src="'.concat(x).concat(i,'"')).replace("PRIVATE_IMG","img"))}"art"===e.dealMode&&function(){var e=k(A),o=I.reduce((function(e,t){return e+=z(t)}),"");e=e.replace("<PRIVATE_STYLES_PATH/>",o),R.map((function(t){var r=B(t.name);e=e.replace(t.rep,r)})),e.match(r).map((function(t){var n=D(t);e=e.replace(r,n)}));var i=T+".html";a.path=n.join(h,i),a.contents=Buffer.from(e);var u=V(e),s=c.green("[success] ".concat(t,"->").concat(i," ")),p=c.underline.yellow(" size: ".concat(u," "));l(s+p),d(null,a)}(),"css"===e.dealMode&&function e(r){var a=this,i=I[r=r||0],s=n.join(S,i);o.readFile(s,(function(o,s){if(o)return a.emit("error",o),d();var p=z(i,"path"),f=n.join(v,"..",p),m=new u.File({path:f,contents:s});q.push(m);var g=n.basename(f),h=V(s),j=c.green("[success] ".concat(t,"->").concat(g," ")),y=c.underline.yellow(" size: ".concat(h," "));if(l(j+y),r===I.length-1)return d();e(++r)}))}(),"js"===e.dealMode&&R.map((function(e,r){var o=M[e.name].toString();if(!o)return d();o=";(function ".concat(o,")(window);");var a=Buffer.from(o),i=B(e.name,"path"),s=n.join(v,"..",i),p=new u.File({path:s,contents:a});q.push(p);var f=n.basename(s),m=V(a),g=c.green("[success] ".concat(t,"->").concat(f," ")),h=c.underline.yellow(" size: ".concat(m," "));return l(g+h),r===R.length-1?d():void 0})),"img"===e.dealMode&&(O=k(A).match(r),function e(r){var a,i=this,s=O[r=r||0],p=D(s,"src");if(!p)return d();/\@/.test(p)?(p=p.replace("@",""),a=n.join(h,p)):a=n.join(S,p),o.readFile(a,(function(o,a){if(o)return i.emit("error",o),d();var p=D(s,"path"),f=n.join(v,"..",p),m=new u.File({path:f,contents:a});q.push(m);var g=n.basename(f),h=V(a),j=c.green("[success] ".concat(t,"->").concat(g," ")),y=c.underline.yellow(" size: ".concat(h," "));if(l(j+y),r===O.length-1)return d();e(++r)}))}())}))}},function(t,r){t.exports=e},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t){e.exports=a}])}));